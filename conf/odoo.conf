[options]
; === CONFIGURACIÓN PARA MÁQUINA 6 CORES / 16GB RAM ===

; --- Addons ---
addons_path = /mnt/enterprise, /mnt/extra_addons, /mnt/local_addons, /mnt/oca
; --- Seguridad ---
admin_passwd = 1234
; Cambia por un hash seguro generado con: python3 -c "from passlib.hash import pbkdf2_sha512; print(pbkdf2_sha512.hash('tu_password_seguro'))"

; --- Base de datos ---
db_host = postgres
db_port = 5432
db_user = odoo
db_password = admin
db_template = template0
db_sslmode = prefer
db_maxconn = 64
; Incrementado para mejor concurrencia con PostgreSQL
db_name = False
; Filtro para mayor seguridad en producción
; dbfilter = ^odoo18.*$

; --- Archivos y datos ---
data_dir = /var/lib/odoo
csv_internal_sep = ,
geoip_database = /usr/share/GeoIP/GeoLite2-City.mmdb
screenshots = /tmp/odoo_tests

; --- Red y HTTP ---
http_enable = True
http_interface = 0.0.0.0
http_port = 8069
longpolling_port = 8072
proxy_mode = True

; --- Perfil alternativo si no funcionan los workers y el longpolling ---
workers = 0
max_cron_threads = 1

; --- Workers y memoria (contenedor 4 vCPU / 6GB) ---
; Fórmula de referencia: (cores * 2) - 1 = 7 -> ajustado por RAM
; Mantener 3 workers para dar más margen de memoria y evitar reinicios
# workers = 3
; Máximo 1 thread para cron jobs
# max_cron_threads = 1

; Límites de memoria por worker: soft ~1.5GB, hard ~2GB
; 3 workers x 2GB ~= 6GB (cerca del límite del contenedor)
limit_memory_soft = 1610612736
limit_memory_hard = 2147483648
; Número máximo de requests por worker antes de reiniciar
limit_request = 8192

; --- Perfil alternativo (comentado) para 8 vCPU / 12GB ---
;workers = 6
;max_cron_threads = 2
;limit_memory_soft = 2147483648   ; 2GB
;limit_memory_hard = 3221225472   ; 3GB

; --- Límites de CPU optimizados ---
; 10 minutos CPU time por request
limit_time_cpu = 600
; 20 minutos real time por request
limit_time_real = 1200
; 1 hora para cron jobs
limit_time_real_cron = 3600

; --- Gestión de memoria cache ---
; osv_memory_age_limit = 1.0
; Limpia objetos en memoria después de 1 hora
; Sin límite por cantidad
osv_memory_count_limit = False

; --- Logging optimizado ---
; logfile = /var/log/odoo/odoo.log
log_level = info
log_handler = :INFO
log_rotate = True
log_db = False
log_db_level = warning
syslog = False

; --- Email (configurar según tu SMTP) ---
; smtp_server = localhost
; smtp_port = 587
; smtp_ssl = True
; smtp_user = False
; smtp_password = False
; email_from = noreply@tudominio.com
; from_filter = False

; --- Módulos server-wide ---
server_wide_modules = base,web

; --- Optimizaciones adicionales ---
; Compresión de reportes
reportgz = True
; Ocultar lista de BD en producción
list_db = True
; Mejores búsquedas sin acentos
unaccent = True
; Sin datos de demostración en producción
without_demo = True
; Limpieza automática de datos transitorios
transient_age_limit = 1.0

; --- Configuraciones de rendimiento ---
import_partial =
test_enable = False
test_file =
test_tags = None
upgrade_path =
translate_modules = ['all']

; --- Configuración de longpolling ---
gevent_port = 8072
; Puerto dedicado para longpolling/websockets